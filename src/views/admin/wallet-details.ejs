<%- include("../../views/partials/admin/headers") %>
<%- include("../../views/partials/admin/slidebar") %>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">
</head>

<style>
/* Dark Theme with Neon Elements */
body {
    background-color: #1a1a1a; /* Dark background */
    color: #e0e0e0; /* Light text for contrast */
    font-family: 'Arial', sans-serif;
}

.content-main {
    padding: 68px;
    margin-left: 189px;
    margin-top:15px;
    margin-right:85px;

}

/* Card Styling */
.card {
    background-color: #2a2a2a; /* Darker card background */
    border: 1px solid #00ffcc; /* Neon cyan border */
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0, 255, 204, 0.3); /* Neon glow */
    margin-bottom: 20px;
}

.card-header {
    background-color: #333333;
    border-bottom: 1px solid #00ffcc;
    padding: 10px 15px;
}

.card-header h5 {
    color: #00ffcc; /* Neon cyan for headers */
    text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    margin: 0;
}

.card-body {
    padding: 15px;
}

/* Text Styling */
p, td {
    color: #e0e0e0;
}

strong {
    color: #ff00ff; /* Neon magenta for emphasis */
    text-shadow: 0 0 3px rgba(255, 0, 255, 0.5);
}

/* Table Styling */
.table {
    color: #e0e0e0;
}

.table-striped tbody tr:nth-of-type(odd) {
    background-color: #333333;
}

.table-hover tbody tr:hover {
    background-color: #404040;
    box-shadow: 0 0 10px rgba(0, 255, 204, 0.2);
}

.badge-success {
    background-color: #00cc00; /* Neon green */
    color: #1a1a1a;
    text-shadow: 0 0 3px rgba(0, 204, 0, 0.5);
}

.badge-danger {
    background-color: #ff0066; /* Neon pink */
    color: #1a1a1a;
    text-shadow: 0 0 3px rgba(255, 0, 102, 0.5);
}

/* Buttons */
.btn-primary {
    background-color: #00ccff; /* Neon blue */
    border: none;
    color: #1a1a1a;
    text-shadow: 0 0 3px rgba(0, 204, 255, 0.5);
    box-shadow: 0 0 10px rgba(0, 204, 255, 0.4);
    transition: all 0.3s ease;
}

.btn-primary:hover {
    background-color: #00e6ff;
    box-shadow: 0 0 15px rgba(0, 204, 255, 0.6);
}

.btn-danger {
    background-color: #ff0066; /* Neon pink */
    border: none;
    color: #1a1a1a;
    text-shadow: 0 0 3px rgba(255, 0, 102, 0.5);
    box-shadow: 0 0 10px rgba(255, 0, 102, 0.4);
    transition: all 0.3s ease;
}

.btn-danger:hover {
    background-color: #ff3385;
    box-shadow: 0 0 15px rgba(255, 0, 102, 0.6);
}

.btn-secondary {
    background-color: #666666;
    border: none;
    color: #e0e0e0;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background-color: #808080;
    box-shadow: 0 0 10px rgba(128, 128, 128, 0.4);
}

/* Modal Styling */
.modal-content {
    background-color: #2a2a2a;
    border: 1px solid #00ffcc;
    box-shadow: 0 0 20px rgba(0, 255, 204, 0.4);
}

.modal-header {
    background-color: #333333;
    border-bottom: 1px solid #00ffcc;
}

.modal-title {
    color: #00ffcc;
    text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
}

.form-control {
    background-color: #333333;
    border: 1px solid #00ffcc;
    color: #e0e0e0;
    box-shadow: 0 0 5px rgba(0, 255, 204, 0.2);
}

.form-control:focus {
    background-color: #404040;
    border-color: #00e6ff;
    box-shadow: 0 0 10px rgba(0, 230, 255, 0.4);
    color: #e0e0e0;
}

.form-label {
    color: #ff00ff;
    text-shadow: 0 0 3px rgba(255, 0, 255, 0.5);
}

/* Pagination */
.pagination .page-link {
    background-color: #333333;
    border: 1px solid #00ffcc;
    color: #00ffcc;
    text-shadow: 0 0 3px rgba(0, 255, 204, 0.5);
}

.pagination .page-item.active .page-link {
    background-color: #00ffcc;
    color: #1a1a1a;
    border-color: #00ffcc;
    box-shadow: 0 0 10px rgba(0, 255, 204, 0.6);
}

.pagination .page-link:hover {
    background-color: #00e6ff;
    color: #1a1a1a;
    box-shadow: 0 0 10px rgba(0, 230, 255, 0.4);
}

/* Neon Glow Animation */
@keyframes neonGlow {
    0% { box-shadow: 0 0 5px rgba(0, 255, 204, 0.3); }
    50% { box-shadow: 0 0 15px rgba(0, 255, 204, 0.6); }
    100% { box-shadow: 0 0 5px rgba(0, 255, 204, 0.3); }
}

.card, .btn-primary, .btn-danger, .modal-content {
    animation: neonGlow 2s infinite ease-in-out;
}
</style>

<section class="content-main">
    <div class="content-header">
        <h2 class="content-title card-title">Wallet Details - <%= user.name %></h2>
    </div>

    <!-- Wallet Summary -->
    <div class="card">
        <div class="card-header">
            <h5>Wallet Summary</h5>
        </div>
        <div class="card-body">
            <p><strong>User ID:</strong> <%= user._id %></p>
            <p><strong>Name:</strong> <%= user.name %></p>
            <p><strong>Email:</strong> <%= user.email %></p>
            <p><strong>Balance:</strong> ₹<%= user.wallet.toLocaleString('en-IN') %></p>
            <!-- <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#creditModal">Credit Wallet</button>
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#debitModal">Debit Wallet</button> -->
        </div>
    </div>

    <!-- Wallet History -->
    <div class="card">
        <div class="card-header">
            <h5>Wallet History</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (walletHistory && walletHistory.length > 0) { %>
                            <% walletHistory.forEach(history => { %>
                                <tr>
                                    <td><%= history.date.toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' }) %></td>
                                    <td>
                                        <span class="<%= history.type === 'credit' ? 'badge badge-success' : 'badge badge-danger' %>">
                                            <%= history.type.charAt(0).toUpperCase() + history.type.slice(1) %>
                                        </span>
                                    </td>
                                    <td>₹<%= history.amount.toLocaleString('en-IN') %></td>
                                    <td><%= history.description %></td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="4" class="text-center">No wallet history available.</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
            <!-- Pagination -->
            <% if (totalHistory > limit) { %>
                <nav aria-label="Wallet History Pagination">
                    <ul class="pagination justify-content-center mt-3">
                        <% for (let i = 1; i <= Math.ceil(totalHistory / limit); i++) { %>
                            <li class="page-item <%= i === page ? 'active' : '' %>">
                                <a href="?page=<%= i %>&limit=<%= limit %>" class="page-link"><%= i %></a>
                            </li>
                        <% } %>
                    </ul>
                </nav>
            <% } %>
        </div>
    </div>

    <!-- Credit Wallet Modal -->
    <div class="modal fade" id="creditModal" tabindex="-1" aria-labelledby="creditModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="creditModalLabel">Credit Wallet</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="/admin/wallets/<%= user._id %>/credit" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="amount" class="form-label">Amount (₹)</label>
                            <input type="number" name="amount" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <input type="text" name="description" class="form-control" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Credit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Debit Wallet Modal -->
    <div class="modal fade" id="debitModal" tabindex="-1" aria-labelledby="debitModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="debitModalLabel">Debit Wallet</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="/admin/wallets/<%= user._id %>/debit" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="amount" class="form-label">Amount (₹)</label>
                            <input type="number" name="amount" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <input type="text" name="description" class="form-control" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-danger">Debit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const contentMain = document.querySelector(".content-main");

        sidebar.classList.toggle("active");

        if (sidebar.classList.contains("active")) {
            contentMain.style.marginLeft = window.innerWidth <= 768 ? "0" : "0";
        } else {
            contentMain.style.marginLeft = window.innerWidth <= 768 ? "0" : "220px";
        }

        if (sidebar.classList.contains("active")) {
            document.addEventListener("click", closeSidebarOutside);
        } else {
            document.removeEventListener("click", closeSidebarOutside);
        }
    }

    function closeSidebarOutside(event) {
        const sidebar = document.getElementById("sidebar");
        const menuToggle = document.querySelector(".menu-toggle");
        if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
            sidebar.classList.remove("active");
            document.querySelector(".content-main").style.marginLeft = window.innerWidth <= 768 ? "0" : "220px";
            document.removeEventListener("click", closeSidebarOutside);
        }
    }

    window.addEventListener("load", function() {
        const sidebar = document.getElementById("sidebar");
        const contentMain = document.querySelector(".content-main");
        const menuToggle = document.querySelector(".menu-toggle");

        if (menuToggle) {
            menuToggle.addEventListener("click", toggleSidebar);
        }

        if (window.innerWidth <= 768) {
            contentMain.style.marginLeft = "0";
        }
    });

    window.addEventListener("resize", function() {
        const sidebar = document.getElementById("sidebar");
        const contentMain = document.querySelector(".content-main");

        if (window.innerWidth <= 768) {
            contentMain.style.marginLeft = "0";
        } else {
            contentMain.style.marginLeft = sidebar.classList.contains("active") ? "0" : "220px";
        }
    });
</script>

