<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Address</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #fdf2f3;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .address-form-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(212, 131, 138, 0.1);
            width: 100%;
            max-width: 800px;
            padding: 2rem;
            margin: 20px auto;
        }

        .form-title {
            color: #d4838a;
            font-size: 28px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #fdf2f3;
        }

        .form-label {
            color: #9b6b6e;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-control, .form-select {
            border: 2px solid #f3e6e8;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: #d4838a;
            box-shadow: 0 0 0 0.2rem rgba(212, 131, 138, 0.25);
        }

        .error-message {
            color: #d4838a;
            font-size: 0.875rem;
            margin-top: 5px;
            display: none;
        }

        .btn-submit {
            background: linear-gradient(45deg, #d4838a, #e5989b);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 200px;
            margin: 20px auto;
            display: block;
        }

        .btn-submit:hover {
            background: linear-gradient(45deg, #c7747b, #d4838a);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 131, 138, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .address-form-container {
                padding: 1.5rem;
            }
            
            .form-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="address-form-container">
        <form id="address-form" onsubmit="address(event)">
            <h1 class="form-title">Edit Address</h1>
            <input type="hidden" name="addressId" value="<%=address._id%>">
            
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" name="name" value="<%=address.name%>">
                        <div id="error1" class="error-message"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" value="<%=address.email%>">
                        <div id="error2" class="error-message"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="phone" class="form-label">Phone</label>
                        <input type="number" class="form-control" id="phone" name="phone" value="<%=address.phone%>">
                        <div id="error3" class="error-message"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="houseNumber" class="form-label">House Number</label>
                        <input type="text" class="form-control" id="houseNumber" name="houseNumber" value="<%=address.houseNumber%>">
                        <div id="error4" class="error-message"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="city" class="form-label">City</label>
                        <input type="text" class="form-control" id="city" name="city" value="<%=address.city%>">
                        <div id="error6" class="error-message"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="state" class="form-label">State</label>
                        <select id="state" class="form-select" name="state" value="<%=address.state%>">
                            <option selected>Choose</option>
                        </select>
                        <div id="error7" class="error-message"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="district" class="form-label">District</label>
                        <input type="text" class="form-control" id="district" name="district" value="<%=address.district%>">
                        <div id="error8" class="error-message"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="zipCode" class="form-label">ZIP Code</label>
                        <input type="text" class="form-control" id="zipCode" name="zipCode" value="<%=address.zipCode%>">
                        <div id="error9" class="error-message"></div>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn-submit">Update Address</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>


    <script>

        function nameValidateChecking(name){
            const error1 = document.getElementById('error1')
            const namePattern = /^[a-zA-Z\s'-]+$/;
            if(name.trim() == ""){
              error1.style.display = "block"
              error1.innerHTML = "please enter a valid name"
            }else if(!namePattern.test(name)){
              error1.style.display = "block"
              error1.innerHTML = "Name can only contain alpahbets and spaces"
            }else{
              error1.style.display = "none"
              error1.innerHTML = ''
            }
        }
        
        function emailValidateChecking(email){
            const error2 = document.getElementById('error2')
            const emailPattern =  /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
            if(email == ""){
              error2.style.display = "block"
              error2.innerHTML = "please enter a valid email"
            }else if(!emailPattern.test(email)){
              error2.style.display = "block"
              error2.innerHTML = "Invalid Email"
            }else{
              error2.style.display = "none"
              error2.innerHTML = ''
            }
        }
        
        function phoneValidateChecking(phone){
            const error3 = document.getElementById('error3')
            if(phone == ""){
              error3.style.display = "block"
              error3.innerHTML = "Enter a valid phone number"
            }else if (phone.length<10 || phone.length>10){
                error3.style.display = "block"
                error3.innerHTML = "Enter 10 digits"
            }else{
              error3.style.display = "none"
              error3.innerHTML = ""
            }
           
          }
        
          function houseValidatechecking(houseNumber){
            const error4 = document.getElementById('error4')
            if(houseNumber == ''){
                error4.style.display = 'block'
                error4.innerHTML = 'House number is required'
            }else{
                error4.style.display = 'none'
                error4.innerHTML = ''
            }
          }
        
          function cityValidatechecking(city){
            const error6 = document.getElementById('error6')
            if(city == ''){
                error6.style.display = 'block'
                error6.innerHTML = 'address is required'
            }else{
                error6.style.display = 'none'
                error6.innerHTML = ''
            }
          }
          function stateValidatechecking(state){
            const error7 = document.getElementById('error7')
            if(state == ''){
                error7.style.display = 'block'
                error7.innerHTML = 'address is required'
            }else{
                error7.style.display = 'none'
                error7.innerHTML = ''
            }
          }
        
          function districtValidastechecking(district){
            const error8 = document.getElementById('error8')
            if(district == ''){
                error8.style.display = 'block'
                error8.innerHTML = 'district is required'
            }else{
                error8.style.display = 'none'
                error8.innerHTML = ''
            }
          }
        
          function zipCodeValidatechecking(zipCode){
            if(zipCode == ''){
                error9.style.display = 'block'
                error9.innerHTML = 'zipcode is required'
            }else if(zipCode.length !== 6 ){
                error9.style.display = 'block'
                error9.innerHTML = "Zip Code must be 6 digits"
            }
            else{
                error9.style.display = 'none'
                error9.innerHTML = ''
            }
          }
        
        async function address(event){
            event.preventDefault(); 
            const form = document.getElementById('address-form');
            const name = form["name"].value.trim();
            const email = form["email"].value.trim();
            const phone = form["phone"].value.trim();
            const houseNumber = form["houseNumber"].value.trim();
            const city = form["city"].value.trim();
            const state = form["state"].value;
            const district = form["district"].value.trim();
            const zipCode = form["zipCode"].value.trim();
            const addressId = form['addressId'].value
            nameValidateChecking(name)
            emailValidateChecking(email)
            phoneValidateChecking(phone)
            houseValidatechecking(houseNumber)
            cityValidatechecking(city)
            stateValidatechecking(state)
            districtValidastechecking(district)
            zipCodeValidatechecking(zipCode)
            const formData = {
                name,
                email,
                phone,
                houseNumber,
                city,
                state,
                district,
                zipCode,
            }
            try {
                const response = await fetch(`/editted/${addressId}`,{
                    method:'PUT',
                    headers:{'Content-Type':"application/json"},
                    body:JSON.stringify(formData)
            
                })
                if(response.ok){
                   await response.json()
                    window.location.href = '/checkout'
                }
            } catch (error) {
                console.log("The error"+error)
            }
        
        }
        </script>
      
    
</body>
</html>